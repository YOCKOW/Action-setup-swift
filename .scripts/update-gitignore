#!/bin/bash

declare -r repository_root=$(cd "$(cd "$(dirname "$0")" && pwd)/.." && pwd)
declare -r gitignore="${repository_root}/.gitignore"

echo "Updating ${gitignore}"

cat <<__GITIGNORE__ >"${gitignore}"
# DO NOT MODIFY: This is autogenerated.
# You can modify ".scripts/update-gitignore"

.DS_Store
node_modules/.bin

__GITIGNORE__

echo "# Node modules that are used only in development." >>"${gitignore}"

cd "${repository_root}"
npm list -only dev | grep -E '^[^A-Za-z]' | \
  sed -E 's:^[^@A-Za-z]+::g' | sed -E 's/@[0-9]+(\.[0-9]+)*([ ]+deduped)?.*$//g' | while read line
do
  printf "node_modules/%s\n" "${line}" >>"${gitignore}"
done
