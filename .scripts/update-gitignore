#!/bin/bash

declare -r repository_root=$(cd "$(cd "$(dirname "$0")" && pwd)/.." && pwd)
declare -r gitignore="${repository_root}/.gitignore"

echo "Updating ${gitignore}"

cat <<__GITIGNORE__ >"${gitignore}"
# DO NOT MODIFY: This is autogenerated.
# You can modify ".scripts/update-gitignore"

.DS_Store
node_modules/.bin

__GITIGNORE__

echo "# Node modules that are used only in development." >>"${gitignore}"

cd "${repository_root}"
./.scripts/dev-deps | while read line
do
  echo "/node_modules/${line}" >>"${gitignore}"
  
  # Ignore files that are already committed.
  if [ -d "${repository_root}/node_modules/${line}" ]; then
    git rm --cached -r "node_modules/${line}" >/dev/null 2>&1
    if [ $? -eq 0 ]; then
      echo "Removed path from index: node_modules/${line}"
    fi
  fi
done
